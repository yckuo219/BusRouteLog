<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>校車 GPS 記錄</title>
  <script>
    let watchId = null;
    const scriptURL = "https://script.google.com/macros/s/AKfycbzhqtkOrzngX2ArPeyMsDihBnJUA5TBzhBf5q4iHol8oyP740bbTowfUfxcvxE9QlMx/exec";

    function startRecording() {
      if (!navigator.geolocation) {
        alert("此瀏覽器不支援定位");
        return;
      }

      watchId = navigator.geolocation.watchPosition(async pos => {
        const { latitude, longitude } = pos.coords;
        document.getElementById("output").textContent =
          `座標: ${latitude.toFixed(7)}, ${longitude.toFixed(7)}`;

        // 使用 Form POST 避免 CORS
        const formData = new URLSearchParams();
        formData.append('lat', latitude);
        formData.append('lng', longitude);

        try {
          const res = await fetch(scriptURL, {
            method: 'POST',
            body: formData
          });

          const text = await res.text();
          console.log("上傳成功: ", text);
        } catch (err) {
          console.error("上傳失敗", err);
        }
      }, err => {
        alert("定位失敗：" + err.message);
      });
    }

    function stopRecording() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        alert("停止記錄");
      }
    }
  </script>
</head>
<body>
  <h2>校車 GPS 記錄系統</h2>
  <button onclick="startRecording()">開始記錄</button>
  <button onclick="stopRecording()">停止記錄</button>
  <p id="output">尚未開始記錄</p>
</body>
</html>
